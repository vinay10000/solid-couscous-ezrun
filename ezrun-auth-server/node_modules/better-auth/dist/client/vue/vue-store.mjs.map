{"version":3,"file":"vue-store.mjs","names":[],"sources":["../../../src/client/vue/vue-store.ts"],"sourcesContent":["import type { Store, StoreValue } from \"nanostores\";\nimport type { DeepReadonly, ShallowRef, UnwrapNestedRefs } from \"vue\";\nimport {\n\tgetCurrentInstance,\n\tgetCurrentScope,\n\tonScopeDispose,\n\treadonly,\n\tshallowRef,\n} from \"vue\";\n\nfunction registerStore(store: Store) {\n\tconst instance = getCurrentInstance();\n\tif (instance && instance.proxy) {\n\t\tconst vm = instance.proxy as any;\n\t\tconst cache = \"_nanostores\" in vm ? vm._nanostores : (vm._nanostores = []);\n\t\tcache.push(store);\n\t}\n}\n\nexport function useStore<\n\tSomeStore extends Store,\n\tValue extends StoreValue<SomeStore>,\n>(store: SomeStore): DeepReadonly<UnwrapNestedRefs<ShallowRef<Value>>> {\n\tconst state = shallowRef();\n\n\tconst unsubscribe = store.subscribe((value) => {\n\t\tstate.value = value;\n\t});\n\n\tif (getCurrentScope()) onScopeDispose(unsubscribe);\n\n\tif (process.env.NODE_ENV !== \"production\") {\n\t\tregisterStore(store);\n\t\treturn readonly(state);\n\t}\n\treturn state;\n}\n"],"mappings":";;;AAUA,SAAS,cAAc,OAAc;CACpC,MAAM,WAAW,oBAAoB;AACrC,KAAI,YAAY,SAAS,OAAO;EAC/B,MAAM,KAAK,SAAS;AAEpB,GADc,iBAAiB,KAAK,GAAG,cAAe,GAAG,cAAc,EAAE,EACnE,KAAK,MAAM;;;AAInB,SAAgB,SAGd,OAAqE;CACtE,MAAM,QAAQ,YAAY;CAE1B,MAAM,cAAc,MAAM,WAAW,UAAU;AAC9C,QAAM,QAAQ;GACb;AAEF,KAAI,iBAAiB,CAAE,gBAAe,YAAY;AAElD,KAAI,QAAQ,IAAI,aAAa,cAAc;AAC1C,gBAAc,MAAM;AACpB,SAAO,SAAS,MAAM;;AAEvB,QAAO"}