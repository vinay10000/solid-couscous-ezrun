{"version":3,"file":"crud-org.mjs","names":["options","member:\n\t\t\t\t| (Member & InferAdditionalFieldsFromPluginOptions<\"member\", O, false>)\n\t\t\t\t| undefined","teamMember: TeamMember | null","organization"],"sources":["../../../../src/plugins/organization/routes/crud-org.ts"],"sourcesContent":["import { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { getSessionFromCtx, requestOnlySessionMiddleware } from \"../../../api\";\nimport { setSessionCookie } from \"../../../cookies\";\nimport type { InferAdditionalFieldsFromPluginOptions } from \"../../../db\";\nimport { toZodSchema } from \"../../../db\";\nimport { getOrgAdapter } from \"../adapter\";\nimport { orgMiddleware, orgSessionMiddleware } from \"../call\";\nimport { ORGANIZATION_ERROR_CODES } from \"../error-codes\";\nimport { hasPermission } from \"../has-permission\";\nimport type {\n\tInferInvitation,\n\tInferMember,\n\tInferOrganization,\n\tInferTeam,\n\tMember,\n\tTeamMember,\n} from \"../schema\";\nimport type { OrganizationOptions } from \"../types\";\n\nconst baseOrganizationSchema = z.object({\n\tname: z.string().min(1).meta({\n\t\tdescription: \"The name of the organization\",\n\t}),\n\tslug: z.string().min(1).meta({\n\t\tdescription: \"The slug of the organization\",\n\t}),\n\tuserId: z.coerce\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The user id of the organization creator. If not provided, the current user will be used. Should only be used by admins or when called by the server. server-only. Eg: \"user-id\"',\n\t\t})\n\t\t.optional(),\n\tlogo: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"The logo of the organization\",\n\t\t})\n\t\t.optional(),\n\tmetadata: z\n\t\t.record(z.string(), z.any())\n\t\t.meta({\n\t\t\tdescription: \"The metadata of the organization\",\n\t\t})\n\t\t.optional(),\n\tkeepCurrentActiveOrganization: z\n\t\t.boolean()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t\"Whether to keep the current active organization active after creating a new one. Eg: true\",\n\t\t})\n\t\t.optional(),\n});\n\nexport const createOrganization = <O extends OrganizationOptions>(\n\toptions?: O | undefined,\n) => {\n\tconst additionalFieldsSchema = toZodSchema({\n\t\tfields: options?.schema?.organization?.additionalFields || {},\n\t\tisClientSide: true,\n\t});\n\n\ttype Body = InferAdditionalFieldsFromPluginOptions<\"organization\", O> &\n\t\tz.infer<typeof baseOrganizationSchema>;\n\n\treturn createAuthEndpoint(\n\t\t\"/organization/create\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: z.object({\n\t\t\t\t...baseOrganizationSchema.shape,\n\t\t\t\t...additionalFieldsSchema.shape,\n\t\t\t}),\n\t\t\tuse: [orgMiddleware],\n\t\t\tmetadata: {\n\t\t\t\t$Infer: {\n\t\t\t\t\tbody: {} as Body,\n\t\t\t\t},\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Create an organization\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"The organization that was created\",\n\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/Organization\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = await getSessionFromCtx(ctx);\n\n\t\t\tif (!session && (ctx.request || ctx.headers)) {\n\t\t\t\tthrow new APIError(\"UNAUTHORIZED\");\n\t\t\t}\n\t\t\tlet user = session?.user || null;\n\t\t\tif (!user) {\n\t\t\t\tif (!ctx.body.userId) {\n\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\");\n\t\t\t\t}\n\t\t\t\tuser = await ctx.context.internalAdapter.findUserById(ctx.body.userId);\n\t\t\t}\n\t\t\tif (!user) {\n\t\t\t\treturn ctx.json(null, {\n\t\t\t\t\tstatus: 401,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst options = ctx.context.orgOptions;\n\t\t\tconst canCreateOrg =\n\t\t\t\ttypeof options?.allowUserToCreateOrganization === \"function\"\n\t\t\t\t\t? await options.allowUserToCreateOrganization(user)\n\t\t\t\t\t: options?.allowUserToCreateOrganization === undefined\n\t\t\t\t\t\t? true\n\t\t\t\t\t\t: options.allowUserToCreateOrganization;\n\n\t\t\tconst isSystemAction = !session && ctx.body.userId;\n\n\t\t\tif (!canCreateOrg && !isSystemAction) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options as O);\n\n\t\t\tconst userOrganizations = await adapter.listOrganizations(user.id);\n\t\t\tconst hasReachedOrgLimit =\n\t\t\t\ttypeof options.organizationLimit === \"number\"\n\t\t\t\t\t? userOrganizations.length >= options.organizationLimit\n\t\t\t\t\t: typeof options.organizationLimit === \"function\"\n\t\t\t\t\t\t? await options.organizationLimit(user)\n\t\t\t\t\t\t: false;\n\n\t\t\tif (hasReachedOrgLimit) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_HAVE_REACHED_THE_MAXIMUM_NUMBER_OF_ORGANIZATIONS,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst existingOrganization = await adapter.findOrganizationBySlug(\n\t\t\t\tctx.body.slug,\n\t\t\t);\n\t\t\tif (existingOrganization) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_ALREADY_EXISTS,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tlet {\n\t\t\t\tkeepCurrentActiveOrganization: _,\n\t\t\t\tuserId: __,\n\t\t\t\t...orgData\n\t\t\t} = ctx.body;\n\n\t\t\tif (options.organizationCreation?.beforeCreate) {\n\t\t\t\tconst response = await options.organizationCreation.beforeCreate(\n\t\t\t\t\t{\n\t\t\t\t\t\torganization: {\n\t\t\t\t\t\t\t...orgData,\n\t\t\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tuser,\n\t\t\t\t\t},\n\t\t\t\t\tctx.request,\n\t\t\t\t);\n\t\t\t\tif (response && typeof response === \"object\" && \"data\" in response) {\n\t\t\t\t\torgData = {\n\t\t\t\t\t\t...ctx.body,\n\t\t\t\t\t\t...response.data,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (options?.organizationHooks?.beforeCreateOrganization) {\n\t\t\t\tconst response =\n\t\t\t\t\tawait options?.organizationHooks.beforeCreateOrganization({\n\t\t\t\t\t\torganization: orgData,\n\t\t\t\t\t\tuser,\n\t\t\t\t\t});\n\t\t\t\tif (response && typeof response === \"object\" && \"data\" in response) {\n\t\t\t\t\torgData = {\n\t\t\t\t\t\t...ctx.body,\n\t\t\t\t\t\t...response.data,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst organization = await adapter.createOrganization({\n\t\t\t\torganization: {\n\t\t\t\t\t...orgData,\n\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tlet member:\n\t\t\t\t| (Member & InferAdditionalFieldsFromPluginOptions<\"member\", O, false>)\n\t\t\t\t| undefined;\n\t\t\tlet teamMember: TeamMember | null = null;\n\t\t\tlet data = {\n\t\t\t\tuserId: user.id,\n\t\t\t\torganizationId: organization.id,\n\t\t\t\trole: ctx.context.orgOptions.creatorRole || \"owner\",\n\t\t\t};\n\t\t\tif (options?.organizationHooks?.beforeAddMember) {\n\t\t\t\tconst response = await options?.organizationHooks.beforeAddMember({\n\t\t\t\t\tmember: {\n\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\torganizationId: organization.id,\n\t\t\t\t\t\trole: ctx.context.orgOptions.creatorRole || \"owner\",\n\t\t\t\t\t},\n\t\t\t\t\tuser,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t\tif (response && typeof response === \"object\" && \"data\" in response) {\n\t\t\t\t\tdata = {\n\t\t\t\t\t\t...data,\n\t\t\t\t\t\t...response.data,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t\tmember = await adapter.createMember(data);\n\t\t\tif (options?.organizationHooks?.afterAddMember) {\n\t\t\t\tawait options?.organizationHooks.afterAddMember({\n\t\t\t\t\tmember,\n\t\t\t\t\tuser,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (\n\t\t\t\toptions?.teams?.enabled &&\n\t\t\t\toptions.teams.defaultTeam?.enabled !== false\n\t\t\t) {\n\t\t\t\tlet teamData = {\n\t\t\t\t\torganizationId: organization.id,\n\t\t\t\t\tname: `${organization.name}`,\n\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t};\n\t\t\t\tif (options?.organizationHooks?.beforeCreateTeam) {\n\t\t\t\t\tconst response = await options?.organizationHooks.beforeCreateTeam({\n\t\t\t\t\t\tteam: {\n\t\t\t\t\t\t\torganizationId: organization.id,\n\t\t\t\t\t\t\tname: `${organization.name}`,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tuser,\n\t\t\t\t\t\torganization,\n\t\t\t\t\t});\n\t\t\t\t\tif (response && typeof response === \"object\" && \"data\" in response) {\n\t\t\t\t\t\tteamData = {\n\t\t\t\t\t\t\t...teamData,\n\t\t\t\t\t\t\t...response.data,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconst defaultTeam =\n\t\t\t\t\t(await options.teams.defaultTeam?.customCreateDefaultTeam?.(\n\t\t\t\t\t\torganization,\n\t\t\t\t\t\tctx,\n\t\t\t\t\t)) || (await adapter.createTeam(teamData));\n\n\t\t\t\tteamMember = await adapter.findOrCreateTeamMember({\n\t\t\t\t\tteamId: defaultTeam.id,\n\t\t\t\t\tuserId: user.id,\n\t\t\t\t});\n\n\t\t\t\tif (options?.organizationHooks?.afterCreateTeam) {\n\t\t\t\t\tawait options?.organizationHooks.afterCreateTeam({\n\t\t\t\t\t\tteam: defaultTeam,\n\t\t\t\t\t\tuser,\n\t\t\t\t\t\torganization,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (options.organizationCreation?.afterCreate) {\n\t\t\t\tawait options.organizationCreation.afterCreate(\n\t\t\t\t\t{\n\t\t\t\t\t\torganization,\n\t\t\t\t\t\tuser,\n\t\t\t\t\t\tmember,\n\t\t\t\t\t},\n\t\t\t\t\tctx.request,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (options?.organizationHooks?.afterCreateOrganization) {\n\t\t\t\tawait options?.organizationHooks.afterCreateOrganization({\n\t\t\t\t\torganization,\n\t\t\t\t\tuser,\n\t\t\t\t\tmember,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (ctx.context.session && !ctx.body.keepCurrentActiveOrganization) {\n\t\t\t\tawait adapter.setActiveOrganization(\n\t\t\t\t\tctx.context.session.session.token,\n\t\t\t\t\torganization.id,\n\t\t\t\t\tctx,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tteamMember &&\n\t\t\t\tctx.context.session &&\n\t\t\t\t!ctx.body.keepCurrentActiveOrganization\n\t\t\t) {\n\t\t\t\tawait adapter.setActiveTeam(\n\t\t\t\t\tctx.context.session.session.token,\n\t\t\t\t\tteamMember.teamId,\n\t\t\t\t\tctx,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn ctx.json({\n\t\t\t\t...organization,\n\t\t\t\tmetadata:\n\t\t\t\t\torganization.metadata && typeof organization.metadata === \"string\"\n\t\t\t\t\t\t? JSON.parse(organization.metadata)\n\t\t\t\t\t\t: organization.metadata,\n\t\t\t\tmembers: [member],\n\t\t\t});\n\t\t},\n\t);\n};\n\nconst checkOrganizationSlugBodySchema = z.object({\n\tslug: z.string().meta({\n\t\tdescription: 'The organization slug to check. Eg: \"my-org\"',\n\t}),\n});\n\nexport const checkOrganizationSlug = <O extends OrganizationOptions>(\n\toptions: O,\n) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/check-slug\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: checkOrganizationSlugBodySchema,\n\t\t\tuse: [requestOnlySessionMiddleware, orgMiddleware],\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst orgAdapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tconst org = await orgAdapter.findOrganizationBySlug(ctx.body.slug);\n\t\t\tif (!org) {\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tstatus: true,\n\t\t\t\t});\n\t\t\t}\n\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\tmessage: \"slug is taken\",\n\t\t\t});\n\t\t},\n\t);\n\nconst baseUpdateOrganizationSchema = z.object({\n\tname: z\n\t\t.string()\n\t\t.min(1)\n\t\t.meta({\n\t\t\tdescription: \"The name of the organization\",\n\t\t})\n\t\t.optional(),\n\tslug: z\n\t\t.string()\n\t\t.min(1)\n\t\t.meta({\n\t\t\tdescription: \"The slug of the organization\",\n\t\t})\n\t\t.optional(),\n\tlogo: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"The logo of the organization\",\n\t\t})\n\t\t.optional(),\n\tmetadata: z\n\t\t.record(z.string(), z.any())\n\t\t.meta({\n\t\t\tdescription: \"The metadata of the organization\",\n\t\t})\n\t\t.optional(),\n});\n\nexport const updateOrganization = <O extends OrganizationOptions>(\n\toptions?: O | undefined,\n) => {\n\tconst additionalFieldsSchema = toZodSchema({\n\t\tfields: options?.schema?.organization?.additionalFields || {},\n\t\tisClientSide: true,\n\t});\n\ttype Body = {\n\t\tdata: {\n\t\t\tname?: string | undefined;\n\t\t\tslug?: string | undefined;\n\t\t\tlogo?: string | undefined;\n\t\t\tmetadata?: Record<string, any> | undefined;\n\t\t} & Partial<InferAdditionalFieldsFromPluginOptions<\"organization\", O>>;\n\t\torganizationId?: string | undefined;\n\t};\n\treturn createAuthEndpoint(\n\t\t\"/organization/update\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: z.object({\n\t\t\t\tdata: z\n\t\t\t\t\t.object({\n\t\t\t\t\t\t...additionalFieldsSchema.shape,\n\t\t\t\t\t\t...baseUpdateOrganizationSchema.shape,\n\t\t\t\t\t})\n\t\t\t\t\t.partial(),\n\t\t\t\torganizationId: z\n\t\t\t\t\t.string()\n\t\t\t\t\t.meta({\n\t\t\t\t\t\tdescription: 'The organization ID. Eg: \"org-id\"',\n\t\t\t\t\t})\n\t\t\t\t\t.optional(),\n\t\t\t}),\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgMiddleware],\n\t\t\tmetadata: {\n\t\t\t\t$Infer: {\n\t\t\t\t\tbody: {} as Body,\n\t\t\t\t},\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Update an organization\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"The updated organization\",\n\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/Organization\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = await ctx.context.getSession(ctx);\n\t\t\tif (!session) {\n\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\tmessage: \"User not found\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst organizationId =\n\t\t\t\tctx.body.organizationId || session.session.activeOrganizationId;\n\t\t\tif (!organizationId) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tconst member = await adapter.findMemberByOrgId({\n\t\t\t\tuserId: session.user.id,\n\t\t\t\torganizationId: organizationId,\n\t\t\t});\n\t\t\tif (!member) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst canUpdateOrg = await hasPermission(\n\t\t\t\t{\n\t\t\t\t\tpermissions: {\n\t\t\t\t\t\torganization: [\"update\"],\n\t\t\t\t\t},\n\t\t\t\t\trole: member.role,\n\t\t\t\t\toptions: ctx.context.orgOptions,\n\t\t\t\t\torganizationId,\n\t\t\t\t},\n\t\t\t\tctx,\n\t\t\t);\n\t\t\tif (!canUpdateOrg) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\t\t\t// Check if slug is being updated and validate uniqueness\n\t\t\tif (typeof ctx.body.data.slug === \"string\") {\n\t\t\t\tconst existingOrganization = await adapter.findOrganizationBySlug(\n\t\t\t\t\tctx.body.data.slug,\n\t\t\t\t);\n\t\t\t\tif (\n\t\t\t\t\texistingOrganization &&\n\t\t\t\t\texistingOrganization.id !== organizationId\n\t\t\t\t) {\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_SLUG_ALREADY_TAKEN,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (options?.organizationHooks?.beforeUpdateOrganization) {\n\t\t\t\tconst response =\n\t\t\t\t\tawait options.organizationHooks.beforeUpdateOrganization({\n\t\t\t\t\t\torganization: ctx.body.data,\n\t\t\t\t\t\tuser: session.user,\n\t\t\t\t\t\tmember,\n\t\t\t\t\t});\n\t\t\t\tif (response && typeof response === \"object\" && \"data\" in response) {\n\t\t\t\t\tctx.body.data = {\n\t\t\t\t\t\t...ctx.body.data,\n\t\t\t\t\t\t...response.data,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst updatedOrg = await adapter.updateOrganization(\n\t\t\t\torganizationId,\n\t\t\t\tctx.body.data,\n\t\t\t);\n\t\t\tif (options?.organizationHooks?.afterUpdateOrganization) {\n\t\t\t\tawait options.organizationHooks.afterUpdateOrganization({\n\t\t\t\t\torganization: updatedOrg,\n\t\t\t\t\tuser: session.user,\n\t\t\t\t\tmember,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn ctx.json(updatedOrg);\n\t\t},\n\t);\n};\n\nconst deleteOrganizationBodySchema = z.object({\n\torganizationId: z.string().meta({\n\t\tdescription: \"The organization id to delete\",\n\t}),\n});\n\nexport const deleteOrganization = <O extends OrganizationOptions>(\n\toptions: O,\n) => {\n\treturn createAuthEndpoint(\n\t\t\"/organization/delete\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: deleteOrganizationBodySchema,\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgMiddleware],\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Delete an organization\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"The organization id that was deleted\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst disableOrganizationDeletion =\n\t\t\t\tctx.context.orgOptions.organizationDeletion?.disabled ||\n\t\t\t\tctx.context.orgOptions.disableOrganizationDeletion;\n\t\t\tif (disableOrganizationDeletion) {\n\t\t\t\tif (ctx.context.orgOptions.organizationDeletion?.disabled) {\n\t\t\t\t\tctx.context.logger.info(\n\t\t\t\t\t\t\"`organizationDeletion.disabled` is deprecated. Use `disableOrganizationDeletion` instead\",\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tthrow new APIError(\"NOT_FOUND\", {\n\t\t\t\t\tmessage: \"Organization deletion is disabled\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst session = await ctx.context.getSession(ctx);\n\t\t\tif (!session) {\n\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", { status: 401 });\n\t\t\t}\n\n\t\t\tconst organizationId = ctx.body.organizationId;\n\t\t\tif (!organizationId) {\n\t\t\t\treturn ctx.json(null, {\n\t\t\t\t\tstatus: 400,\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tconst member = await adapter.findMemberByOrgId({\n\t\t\t\tuserId: session.user.id,\n\t\t\t\torganizationId: organizationId,\n\t\t\t});\n\t\t\tif (!member) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst canDeleteOrg = await hasPermission(\n\t\t\t\t{\n\t\t\t\t\trole: member.role,\n\t\t\t\t\tpermissions: {\n\t\t\t\t\t\torganization: [\"delete\"],\n\t\t\t\t\t},\n\t\t\t\t\torganizationId,\n\t\t\t\t\toptions: ctx.context.orgOptions,\n\t\t\t\t},\n\t\t\t\tctx,\n\t\t\t);\n\t\t\tif (!canDeleteOrg) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (organizationId === session.session.activeOrganizationId) {\n\t\t\t\t/**\n\t\t\t\t * If the organization is deleted, we set the active organization to null\n\t\t\t\t */\n\t\t\t\tawait adapter.setActiveOrganization(session.session.token, null, ctx);\n\t\t\t}\n\n\t\t\tconst org = await adapter.findOrganizationById(organizationId);\n\t\t\tif (!org) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\");\n\t\t\t}\n\t\t\tif (options?.organizationHooks?.beforeDeleteOrganization) {\n\t\t\t\tawait options.organizationHooks.beforeDeleteOrganization({\n\t\t\t\t\torganization: org,\n\t\t\t\t\tuser: session.user,\n\t\t\t\t});\n\t\t\t}\n\t\t\tawait adapter.deleteOrganization(organizationId);\n\t\t\tif (options?.organizationHooks?.afterDeleteOrganization) {\n\t\t\t\tawait options.organizationHooks.afterDeleteOrganization({\n\t\t\t\t\torganization: org,\n\t\t\t\t\tuser: session.user,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn ctx.json(org);\n\t\t},\n\t);\n};\n\nconst getFullOrganizationQuerySchema = z.optional(\n\tz.object({\n\t\torganizationId: z\n\t\t\t.string()\n\t\t\t.meta({\n\t\t\t\tdescription: \"The organization id to get\",\n\t\t\t})\n\t\t\t.optional(),\n\t\torganizationSlug: z\n\t\t\t.string()\n\t\t\t.meta({\n\t\t\t\tdescription: \"The organization slug to get\",\n\t\t\t})\n\t\t\t.optional(),\n\t\tmembersLimit: z\n\t\t\t.number()\n\t\t\t.or(z.string().transform((val) => parseInt(val)))\n\t\t\t.meta({\n\t\t\t\tdescription:\n\t\t\t\t\t\"The limit of members to get. By default, it uses the membershipLimit option which defaults to 100.\",\n\t\t\t})\n\t\t\t.optional(),\n\t}),\n);\n\nexport const getFullOrganization = <O extends OrganizationOptions>(\n\toptions: O,\n) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/get-full-organization\",\n\t\t{\n\t\t\tmethod: \"GET\",\n\t\t\tquery: getFullOrganizationQuerySchema,\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgMiddleware, orgSessionMiddleware],\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"getOrganization\",\n\t\t\t\t\tdescription: \"Get the full organization\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"The organization\",\n\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/Organization\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\t\t\tconst organizationId =\n\t\t\t\tctx.query?.organizationSlug ||\n\t\t\t\tctx.query?.organizationId ||\n\t\t\t\tsession.session.activeOrganizationId;\n\t\t\t// return null if no organization is found to avoid erroring since this is a usual scenario\n\t\t\tif (!organizationId) {\n\t\t\t\treturn ctx.json(null, {\n\t\t\t\t\tstatus: 200,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tconst organization = await adapter.findFullOrganization({\n\t\t\t\torganizationId,\n\t\t\t\tisSlug: !!ctx.query?.organizationSlug,\n\t\t\t\tincludeTeams: ctx.context.orgOptions.teams?.enabled,\n\t\t\t\tmembersLimit: ctx.query?.membersLimit,\n\t\t\t});\n\t\t\tif (!organization) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst isMember = await adapter.checkMembership({\n\t\t\t\tuserId: session.user.id,\n\t\t\t\torganizationId: organization.id,\n\t\t\t});\n\t\t\tif (!isMember) {\n\t\t\t\tawait adapter.setActiveOrganization(session.session.token, null, ctx);\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\ttype OrganizationReturn = O[\"teams\"] extends { enabled: true }\n\t\t\t\t? {\n\t\t\t\t\t\tmembers: InferMember<O, false>[];\n\t\t\t\t\t\tinvitations: InferInvitation<O, false>[];\n\t\t\t\t\t\tteams: InferTeam<O, false>[];\n\t\t\t\t\t} & InferOrganization<O, false>\n\t\t\t\t: {\n\t\t\t\t\t\tmembers: InferMember<O, false>[];\n\t\t\t\t\t\tinvitations: InferInvitation<O, false>[];\n\t\t\t\t\t} & InferOrganization<O, false>;\n\t\t\treturn ctx.json(organization as unknown as OrganizationReturn);\n\t\t},\n\t);\n\nconst setActiveOrganizationBodySchema = z.object({\n\torganizationId: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The organization id to set as active. It can be null to unset the active organization. Eg: \"org-id\"',\n\t\t})\n\t\t.nullable()\n\t\t.optional(),\n\torganizationSlug: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The organization slug to set as active. It can be null to unset the active organization if organizationId is not provided. Eg: \"org-slug\"',\n\t\t})\n\t\t.optional(),\n});\n\nexport const setActiveOrganization = <O extends OrganizationOptions>(\n\toptions: O,\n) => {\n\treturn createAuthEndpoint(\n\t\t\"/organization/set-active\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: setActiveOrganizationBodySchema,\n\t\t\tuse: [orgSessionMiddleware, orgMiddleware],\n\t\t\trequireHeaders: true,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"setActiveOrganization\",\n\t\t\t\t\tdescription: \"Set the active organization\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"The organization\",\n\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/Organization\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tconst session = ctx.context.session;\n\t\t\tlet organizationId = ctx.body.organizationId;\n\t\t\tconst organizationSlug = ctx.body.organizationSlug;\n\n\t\t\tif (organizationId === null) {\n\t\t\t\tconst sessionOrgId = session.session.activeOrganizationId;\n\t\t\t\tif (!sessionOrgId) {\n\t\t\t\t\treturn ctx.json(null);\n\t\t\t\t}\n\t\t\t\tconst updatedSession = await adapter.setActiveOrganization(\n\t\t\t\t\tsession.session.token,\n\t\t\t\t\tnull,\n\t\t\t\t\tctx,\n\t\t\t\t);\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession: updatedSession,\n\t\t\t\t\tuser: session.user,\n\t\t\t\t});\n\t\t\t\treturn ctx.json(null);\n\t\t\t}\n\n\t\t\tif (!organizationId && !organizationSlug) {\n\t\t\t\tconst sessionOrgId = session.session.activeOrganizationId;\n\t\t\t\tif (!sessionOrgId) {\n\t\t\t\t\treturn ctx.json(null);\n\t\t\t\t}\n\t\t\t\torganizationId = sessionOrgId;\n\t\t\t}\n\n\t\t\tif (organizationSlug && !organizationId) {\n\t\t\t\tconst organization =\n\t\t\t\t\tawait adapter.findOrganizationBySlug(organizationSlug);\n\t\t\t\tif (!organization) {\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\torganizationId = organization.id;\n\t\t\t}\n\n\t\t\tif (!organizationId) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst isMember = await adapter.checkMembership({\n\t\t\t\tuserId: session.user.id,\n\t\t\t\torganizationId,\n\t\t\t});\n\t\t\tif (!isMember) {\n\t\t\t\tawait adapter.setActiveOrganization(session.session.token, null, ctx);\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst organization = await adapter.findOrganizationById(organizationId);\n\t\t\tif (!organization) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst updatedSession = await adapter.setActiveOrganization(\n\t\t\t\tsession.session.token,\n\t\t\t\torganization.id,\n\t\t\t\tctx,\n\t\t\t);\n\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\tsession: updatedSession,\n\t\t\t\tuser: session.user,\n\t\t\t});\n\t\t\ttype OrganizationReturn = O[\"teams\"] extends { enabled: true }\n\t\t\t\t? {\n\t\t\t\t\t\tmembers: InferMember<O, false>[];\n\t\t\t\t\t\tinvitations: InferInvitation<O, false>[];\n\t\t\t\t\t\tteams: InferTeam<O, false>[];\n\t\t\t\t\t} & InferOrganization<O, false>\n\t\t\t\t: {\n\t\t\t\t\t\tmembers: InferMember<O, false>[];\n\t\t\t\t\t\tinvitations: InferInvitation<O, false>[];\n\t\t\t\t\t} & InferOrganization<O, false>;\n\t\t\treturn ctx.json(organization as unknown as OrganizationReturn);\n\t\t},\n\t);\n};\n\nexport const listOrganizations = <O extends OrganizationOptions>(options: O) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/list\",\n\t\t{\n\t\t\tmethod: \"GET\",\n\t\t\tuse: [orgMiddleware, orgSessionMiddleware],\n\t\t\trequireHeaders: true,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"List all organizations\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/Organization\",\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tconst organizations = await adapter.listOrganizations(\n\t\t\t\tctx.context.session.user.id,\n\t\t\t);\n\t\t\treturn ctx.json(organizations);\n\t\t},\n\t);\n"],"mappings":"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"}